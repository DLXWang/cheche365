package com.cheche365.cheche.scheduletask.listener
import com.cheche365.cheche.core.message.InsuranceImportResultMessage
import com.cheche365.cheche.scheduletask.app.config.ScheduleTaskConfig
import org.junit.After
import org.junit.Before
import org.junit.Test
import org.junit.runner.RunWith
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.data.redis.core.StringRedisTemplate
import org.springframework.test.context.ContextConfiguration
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner
/**
 * Created by yinJianBin on 2017/9/25.
 */
@RunWith(SpringJUnit4ClassRunner)
@ContextConfiguration(
        classes = [ScheduleTaskConfig]
)
public class InsuranceImportResultCallbackTaskTest {

    @Autowired
    StringRedisTemplate redisTemplate


    @Test
    public void testSendMessage() {
        sendSuccessMessage();
//        sendFailedMessage()
        Thread.sleep(1000 * 60 * 15 as Long)//5分钟
    }

    private void sendSuccessMessage() {
        String messageContent = '{"code":0,"id":"null_0","data":{"domainObjects":[{"rawData":{"order":0,"createTime":"2017-09-25 14:27:49","institution":"天道","insuranceCompanyName":"人保","agentName":"李全","agentIdentity":"430781298566558545","owner":"王大用","licenseNo":"苏C32C68","totalPremium":"965.00","compulsory":"665.00","autoTax":"300.00","upCompulsoryRebate":"0.04","upCompulsoryAmount":"27.35","policyNo":"PDZA201732010000888045","engineNo":"549679C","vinNo":"LGBH12E069Y075815","downCompulsoryAmount":"-2.26","area":{"id":320300,"name":"徐州市","type":{"id":3,"name":"市","description":"市"},"shortCode":"苏C","active":true,"reform":false},"insuranceType":"交强险"},"insuranceCompany":{"id":10000,"name":"人保财险","code":"PICC","logo":"picc5.png","logoUrl":"http://localhost:7310/sr/dev/insurancecompany/logo/picc5.png","slogan":"多快好省，全国通赔","websiteUrl":"http://www.epicc.com.cn/","mobile":"95518","type":1,"recommend":false,"inforArrayList":["全国通赔","50公里免费救援","理赔网点最多","万元1小时赔付"],"renewSupport":true},"auto":{"kilometerPerYear":0,"licensePlateNo":"苏C32C68","engineNo":"549679C","owner":"王大用","vinNo":"LGBH12E069Y075815","disable":false,"billRelated":false},"purchaseOrder":{"createTime":"2017-09-25 14:27:49","payableAmount":"965.00","paidAmount":"965.00","wechatPaymentCalledTimes":0,"version":0,"area":{"id":320300,"name":"徐州市","type":{"id":3,"name":"市","description":"市"},"shortCode":"苏C","active":true,"reform":false},"giftId":[null]},"payment":{"amount":"965.00","paymentType":{"id":1,"name":"initial_payment","description":"首次支付"}},"compulsoryInsurance":{"policyNo":"PDZA201732010000888045","compulsoryPremium":"665.00","autoTax":"300.00","status":"未生效","valid":false},"rebate":{"upCompulsoryAmount":27.35,"upCompulsoryRebate":0.04,"downCompulsoryAmount":-2.26,"downCommercialRebate":0.0,"downCompulsoryRebate":0.0},"institution":{"name":"天道","enable":true,"institutionType":0},"agent":{"name":"李全","identity":"430781298566558545","enable":false,"agentType":0}},{"rawData":{"order":1,"createTime":"2017-09-25 11:14:29","institution":"天道","insuranceCompanyName":"人保","agentName":"刘青","agentIdentity":"311424298911012324","owner":"陈琳","licenseNo":"苏A9W2X2","totalPremium":"4309.96","premium":"4309.96","upCommercialRebate":"0.32","upCommercialAmount":"1418.22","policyNo":"PDAA201732010000820740","engineNo":"322798","vinNo":"LSVNR49J7A2059564","downCommercialAmount":"86.20","area":{"id":320100,"name":"南京市","type":{"id":3,"name":"市","description":"市"},"shortCode":"苏A","active":true,"postalCode":"210000","reform":false},"insuranceType":"商业险"},"insuranceCompany":{"id":10000,"name":"人保财险","code":"PICC","logo":"picc5.png","logoUrl":"http://localhost:7310/sr/dev/insurancecompany/logo/picc5.png","slogan":"多快好省，全国通赔","websiteUrl":"http://www.epicc.com.cn/","mobile":"95518","type":1,"recommend":false,"inforArrayList":["全国通赔","50公里免费救援","理赔网点最多","万元1小时赔付"],"renewSupport":true},"auto":{"kilometerPerYear":0,"licensePlateNo":"苏A9W2X2","engineNo":"322798","owner":"陈琳","vinNo":"LSVNR49J7A2059564","enrollDate":"2010-09-27 00:00:00","disable":false,"billRelated":false},"purchaseOrder":{"createTime":"2017-09-25 11:14:29","payableAmount":"4309.96","paidAmount":"4309.96","wechatPaymentCalledTimes":0,"version":0,"area":{"id":320100,"name":"南京市","type":{"id":3,"name":"市","description":"市"},"shortCode":"苏A","active":true,"postalCode":"210000","reform":false},"giftId":[null]},"payment":{"amount":"4309.96","paymentType":{"id":1,"name":"initial_payment","description":"首次支付"}},"insurance":{"policyNo":"PDAA201732010000820740","premium":"4309.96","iopTotal":0.0,"spontaneousLossIop":0.0,"unableFindThirdPartyPremium":0.0,"status":"未生效","valid":false},"rebate":{"upCommercialAmount":1418.22,"upCommercialRebate":0.32,"downCommercialAmount":86.2,"downCommercialRebate":0.0,"downCompulsoryRebate":0.0},"institution":{"name":"天道","enable":true,"institutionType":0},"insurancePackage":{"id":4171,"compulsory":true,"autoTax":true,"thirdPartyAmount":1000000.0,"thirdPartyIop":true,"damage":false,"damageIop":true,"theft":false,"theftIop":false,"engine":false,"engineIop":false,"glass":false,"glassType":{"id":2,"name":"进口","description":"进口"},"driverAmount":0.0,"driverIop":false,"passengerAmount":0.0,"passengerIop":false,"spontaneousLoss":false,"scratchAmount":0.0,"scratchIop":false,"spontaneousLossIop":false,"unableFindThirdParty":false,"iopTotal":false,"glassTypeId":2,"uniqueString":"11100000000000002110000000"},"agent":{"name":"刘青","identity":"311424298911012324","enable":false,"agentType":0}}]}}'
        redisTemplate.opsForList().leftPush(InsuranceImportResultMessage.QUEUE_LIST, messageContent)
    }

    private void sendFailedMessage() {
        String messageContent = '{"code":1,"data":{"validRecords":[["2394","金联安","人保","2017-03-09","PDAA201632050000417289","管燕萍","655063","苏EK7656","LSVUN65N7C2127294","4834.24","665.00","300.00","3869.24","0.26","0.04","1032.60","3801.64","26+4","转支付宝/转公户","金联安"],["2393","金联安","人保","2017-03-09","PDAA201632050000443212","赵浩","043707D","苏EK7656","LGBF5DE0XDR041418","5511.67","950.00","300.00","4261.67","0.26","0.04","1146.03","4365.64","26+4","转支付宝/转公户","金联安"],["2394","金联安","人保","2017-03-09","PDAA201632050000417299","李建林","655063","苏EL997M","LSVUN65N7C2127294","4834.24","665.00","300.00","3869.24","0.26","0.04","1032.60","3801.64","26+4","转支付宝/转公户","金联安"],["2396","金联安","人保","2017-04-11","PDAA201632050000446571","周利","682003","苏EJ0X13","LSVN221Z7D2112374","3831.17","855.00","300.00","2676.17","0.26","0.04","730.00","3101.17","26+4","转支付宝/转公户","金联安"],["2397","金联安","人保","2017-02-14","PDAA201632050000425133","苏州运达通机械有限公司","DA64307","苏E9523R","LVSFCFAE1DF621347","5307.99","760.00","360.00","4187.99","0.26","0.04","1119.28","4188.71","26+4","转支付宝/转公户","金联安"],["2398","金联安","人保","2017-05-10","PDAA201632050000415788","张国平","AF9H51856","苏EG7Q11","LVVDC11B79D283166","3107.79","760.00","360.00","1987.79","0.26","0.04","547.23","2560.56","26+4","转支付宝/转公户","金联安"],["34","金联安","太平","2017/3/30",null,"王佶",null,"苏EUT775",null,"2135.92","855","360","920.92","0.26","0.04","273.64","1862.28","26+4","转支付宝/转公户","金联安"],["35","金联安","太平","2017/3/30",null,"周月",null,"苏E9J9F7",null,"3755.03","760","150","2845.03","0.26","0.04","770.11","2984.92","26+4","转支付宝/转公户","金联安"],["36","金联安","太平","2017/3/30",null,"张梨",null,"苏E12S89",null,"3078","665","300","2113.00","0.26","0.04","575.98","2502.02","26+4","转支付宝/转公户","金联安"],["37","金联安","太平","2017/3/30",null,"严丽萍",null,"苏EJ380M",null,"4678.93","950","360","3368.93","0.26","0.04","913.92","3765.01","26+4","转支付宝/转公户","金联安"],["38","金联安","太平","2017/3/30",null,"钱丽敏",null,"苏E0HT52",null,"3613.95","665","150","2798.95","0.26","0.04","754.33","2859.62","26+4","转支付宝/转公户","金联安"],["39","金联安","太平","2017/3/30",null,"孙统超",null,"苏E1U216",null,"3290.5","665","300","2325.50","0.26","0.04","631.23","2659.27","26+4","转支付宝/转公户","金联安"],["40","金联安","太平","2017/3/30",null,"张永良",null,"苏EY6N07",null,"3933.01","665","360","2908.01","0.26","0.04","782.68","3150.33","26+4","转支付宝/转公户","金联安"],["41","金联安","太平","2017/3/30",null,"孙明亮",null,"苏EK069K",null,"3527.89","950","360","2217.89","0.26","0.04","614.65","2913.24","26+4","转支付宝/转公户","金联安"]],"invalidRecords":{"invalidData":[{"order":0,"createTime":"2017-09-2514:27:49","institution":"天道","insuranceCompanyName":"人保","agentName":"李全","agentIdentity":"","owner":"王大用","licenseNo":"苏C32C68","totalPremium":"965","compulsory":"665","autoTax":"300","premium":null,"upCompulsoryRebate":"0.04","upCommercialRebate":null,"upCommercialAmount":null,"upCompulsoryAmount":"27.3528301886792","policyNo":"PDZA201732010000888045","engineNo":"549679C","vinNo":"LGBH12E069Y075815","downCommercialAmount":null,"downCompulsoryAmount":"-2.25849056603774","area":null,"insuranceType":"交强险"},{"order":1,"createTime":"2017-09-2511:14:22","institution":"天道","insuranceCompanyName":"人保","agentName":"沈强胜","agentIdentity":"","owner":"邓哲宇","licenseNo":"苏D086Y9","totalPremium":"815","compulsory":"665","autoTax":"150","premium":null,"upCompulsoryRebate":"0.04","upCommercialRebate":null,"upCommercialAmount":null,"upCompulsoryAmount":"27.3528301886792","policyNo":"PDZA201732010000889289","engineNo":"3377199","vinNo":"LVSHCADB3DE344459","downCommercialAmount":null,"downCompulsoryAmount":"-2.25849056603774","area":null,"insuranceType":"交强险"},{"order":2,"createTime":"2017-09-2516:39:00","institution":"天道","insuranceCompanyName":"人保","agentName":"陈菲菲","agentIdentity":"","owner":"王林","licenseNo":"苏C519CD","totalPremium":"1060","compulsory":"760","autoTax":"300","premium":null,"upCompulsoryRebate":"0.04","upCommercialRebate":null,"upCommercialAmount":null,"upCompulsoryAmount":"31.2603773584906","policyNo":"PDZA201732010000888175","engineNo":"FA013057","vinNo":"LVSFKADLXFF244861","downCommercialAmount":null,"downCompulsoryAmount":"-2.5811320754717","area":null,"insuranceType":"交强险"}],"errorDate":[{"order":0,"createTime":"2017-09-2514:27:49","institution":"天道","insuranceCompanyName":"人保","agentName":"李全","agentIdentity":"","owner":"王大用","licenseNo":"苏C32C68","totalPremium":"965","compulsory":"665","autoTax":"300","premium":null,"upCompulsoryRebate":"0.04","upCommercialRebate":null,"upCommercialAmount":null,"upCompulsoryAmount":"27.3528301886792","policyNo":"PDZA201732010000888045","engineNo":"549679C","vinNo":"LGBH12E069Y075815","downCommercialAmount":null,"downCompulsoryAmount":"-2.25849056603774","area":null,"insuranceType":"交强险"},{"order":1,"createTime":"2017-09-2511:14:22","institution":"天道","insuranceCompanyName":"人保","agentName":"沈强胜","agentIdentity":"","owner":"邓哲宇","licenseNo":"苏D086Y9","totalPremium":"815","compulsory":"665","autoTax":"150","premium":null,"upCompulsoryRebate":"0.04","upCommercialRebate":null,"upCommercialAmount":null,"upCompulsoryAmount":"27.3528301886792","policyNo":"PDZA201732010000889289","engineNo":"3377199","vinNo":"LVSHCADB3DE344459","downCommercialAmount":null,"downCompulsoryAmount":"-2.25849056603774","area":null,"insuranceType":"交强险"},{"order":2,"createTime":"2017-09-2516:39:00","institution":"天道","insuranceCompanyName":"人保","agentName":"陈菲菲","agentIdentity":"","owner":"王林","licenseNo":"苏C519CD","totalPremium":"1060","compulsory":"760","autoTax":"300","premium":null,"upCompulsoryRebate":"0.04","upCommercialRebate":null,"upCommercialAmount":null,"upCompulsoryAmount":"31.2603773584906","policyNo":"PDZA201732010000888175","engineNo":"FA013057","vinNo":"LVSFKADLXFF244861","downCommercialAmount":null,"downCompulsoryAmount":"-2.5811320754717","area":null,"insuranceType":"交强险"}],"invalidAmount":[{"order":0,"createTime":"2017-09-2514:27:49","institution":"天道","insuranceCompanyName":"人保","agentName":"李全","agentIdentity":"","owner":"王大用","licenseNo":"苏C32C68","totalPremium":"965","compulsory":"665","autoTax":"300","premium":null,"upCompulsoryRebate":"0.04","upCommercialRebate":null,"upCommercialAmount":null,"upCompulsoryAmount":"27.3528301886792","policyNo":"PDZA201732010000888045","engineNo":"549679C","vinNo":"LGBH12E069Y075815","downCommercialAmount":null,"downCompulsoryAmount":"-2.25849056603774","area":null,"insuranceType":"交强险"},{"order":1,"createTime":"2017-09-2511:14:22","institution":"天道","insuranceCompanyName":"人保","agentName":"沈强胜","agentIdentity":"","owner":"邓哲宇","licenseNo":"苏D086Y9","totalPremium":"815","compulsory":"665","autoTax":"150","premium":null,"upCompulsoryRebate":"0.04","upCommercialRebate":null,"upCommercialAmount":null,"upCompulsoryAmount":"27.3528301886792","policyNo":"PDZA201732010000889289","engineNo":"3377199","vinNo":"LVSHCADB3DE344459","downCommercialAmount":null,"downCompulsoryAmount":"-2.25849056603774","area":null,"insuranceType":"交强险"},{"order":2,"createTime":"2017-09-2516:39:00","institution":"天道","insuranceCompanyName":"人保","agentName":"陈菲菲","agentIdentity":"","owner":"王林","licenseNo":"苏C519CD","totalPremium":"1060","compulsory":"760","autoTax":"300","premium":null,"upCompulsoryRebate":"0.04","upCommercialRebate":null,"upCommercialAmount":null,"upCompulsoryAmount":"31.2603773584906","policyNo":"PDZA201732010000888175","engineNo":"FA013057","vinNo":"LVSFKADLXFF244861","downCommercialAmount":null,"downCompulsoryAmount":"-2.5811320754717","area":null,"insuranceType":"交强险"}]}}}'
        redisTemplate.opsForList().leftPush(InsuranceImportResultMessage.QUEUE_LIST, messageContent)
    }

    @Before
    public void setUp() throws Exception {
    }

    @After
    public void tearDown() throws Exception {
    }
}