package com.cheche365.cheche.zhongan.flow

import groovy.util.logging.Slf4j

import java.text.SimpleDateFormat

import static com.cheche365.cheche.common.Constants.get_DATETIME_FORMAT3
import static com.cheche365.cheche.parser.Constants._DATE_FORMAT3
import static com.cheche365.cheche.parser.Constants._SUPPLEMENT_INFO_BRAND_CODE_TEMPLATE_QUOTING
import static com.cheche365.cheche.parser.Constants._SUPPLEMENT_INFO_CAR_MODEL_LIST_TEMPLATE_QUOTING
import static com.cheche365.cheche.parser.Constants._SUPPLEMENT_INFO_COMMERCIAL_START_DATE_TEMPLATE_QUOTING
import static com.cheche365.cheche.parser.Constants._SUPPLEMENT_INFO_COMPULSORY_START_DATE_TEMPLATE_QUOTING
import static com.cheche365.cheche.parser.util.BusinessUtils.checkCompulsoryPackageOptionEnabled
import static com.cheche365.cheche.parser.util.BusinessUtils.getCommercialInsurancePeriodTexts
import static com.cheche365.cheche.parser.util.BusinessUtils.getCompulsoryInsurancePeriodTexts



/**
 * 流程步骤所需的常量
 */
@Slf4j
class Constants {

    static final _STATUS_CODE_ZHONGAN_CAR_MODEL_NOT_FOUND = 50001L
    static final _STATUS_CODE_ZHONGAN_APPLY_INQUIRY_PRICE_FAILURE = _STATUS_CODE_ZHONGAN_CAR_MODEL_NOT_FOUND + 1
    static final _STATUS_CODE_ZHONGAN_VEHICLE_ACTUAL_PRICE_FAILURE = _STATUS_CODE_ZHONGAN_APPLY_INQUIRY_PRICE_FAILURE + 1
    static final _STATUS_CODE_ZHONGAN_QUOTE_PRICE_FAILURE = _STATUS_CODE_ZHONGAN_VEHICLE_ACTUAL_PRICE_FAILURE + 1
    static final _STATUS_CODE_ZHONGAN_CONFIRM_ORDER_AND_UNDERWRITING_FAILURE = _STATUS_CODE_ZHONGAN_QUOTE_PRICE_FAILURE + 1
    static final _STATUS_CODE_ZHONGAN_CREATE_POLICY_FAILURE = _STATUS_CODE_ZHONGAN_CONFIRM_ORDER_AND_UNDERWRITING_FAILURE + 1
    static final _STATUS_CODE_ZHONGAN_RENEW_FAILURE = _STATUS_CODE_ZHONGAN_CREATE_POLICY_FAILURE + 1

    //格式化字符串
    static final SimpleDateFormat _DATE_FORMAT = new SimpleDateFormat('yyyyMMddHHmmssSSS')


    static final _CITY_SUPPLEMENT_INFO_MAPPINGS = [
        default: [
            _SUPPLEMENT_INFO_COMMERCIAL_START_DATE_TEMPLATE_QUOTING,
            _SUPPLEMENT_INFO_COMPULSORY_START_DATE_TEMPLATE_QUOTING
        ]
    ]

    static final _AUTOTYPE_EXTRACTOR = { context ->
        context.vehicleInfo?.brandName ? [context.vehicleInfo.brandName] : []
    }

    static final _INSURANCE_DATE_EXTRACTOR = { context ->
        def (bsStartDateText, bsEndDateText) = getCommercialInsurancePeriodTexts(context, _DATETIME_FORMAT3, false)
        def (bzStartDateText, bzEndDateText) = getCompulsoryInsurancePeriodTexts(context, _DATETIME_FORMAT3, false)
        def isCompulsory = checkCompulsoryPackageOptionEnabled(context) && context.insurancesCheckList?.compulsory[0]

        [
            effectiveDate          : bsStartDateText ? _DATE_FORMAT3.parse(bsStartDateText) : null,
            expireDate             : bsEndDateText ? _DATE_FORMAT3.parse(bsEndDateText) : null,
            compulsoryEffectiveDate: bzStartDateText && isCompulsory ? _DATE_FORMAT3.parse(bzStartDateText) : null,
            compulsoryExpireDate   : bzEndDateText && isCompulsory ? _DATE_FORMAT3.parse(bzEndDateText) : null
        ]
    }

    static final _VEHICLE_INFO_EXTRACTOR = { context ->
        if (context.carInfo) {
            [
                vinNo     : context.carInfo.vehicleFrameNo,
                engineNo  : context.carInfo.vehicleEngineNo,
                enrollDate: context.carInfo.vehicleRegisterDate ? _DATE_FORMAT3.parse(context.carInfo.vehicleRegisterDate) : null
            ]
        }
    }

    static final get_VEHICLE_MODEL_SUPPLEMENT_INFO_MAPPINGS() {
        [
            default: [
                _SUPPLEMENT_INFO_BRAND_CODE_TEMPLATE_QUOTING,
                _SUPPLEMENT_INFO_CAR_MODEL_LIST_TEMPLATE_QUOTING
            ]
        ]
    }

    static final _ZHONGAN_LOAD_PERSISTENT_STATE = { context, persistentState ->
        [
            insureFlowCode    : persistentState?.insureFlowCode,
            payChannelList    : persistentState?.payChannelList,
            applySignStageFlag: persistentState?.applySignStageFlag,
            materialsStageFlag: persistentState?.materialsStageFlag
        ]
    }

    static final _ZHONGAN_SAVE_PERSISTENT_STATE = { context ->
        [
            insureFlowCode    : context.insureFlowCode,
            payChannelList    : context.payChannelList,
            applySignStageFlag: context.applySignStageFlag,
            materialsStageFlag: context.materialsStageFlag
        ]
    }


    static final _RESULT_CODE_GROUP1 = [
        'B12507',
        'A12600',
        'A13402',
        'A90001',
        'A90015',
        'A90016',
        'A90017',
        'A90018',
        'A90019',
        'B90020',
        'B90021',
        'B90022',
        'B90023',
        'B90024',
        'A90025',
        'A90026',
        'A90027',
        'A90028',
        'A90029',
        'A90032',
        'A90033',
        'A90035',
        'A90036',
        'A90037',
        'A90038',
        'A90044',
        'A90045',
        'A90046',
        'A90047',
        'B90049',
        'B90051',
        'B90052',
        'B90053',
        'A90062',
        'A90063',
        'A90064',
        'A90065',
        'A90066',
        'A90067',
        'A90068',
        'A90069',
        'A90070',
        'A90071',
        'A90074',
        'A90075',
        'A90076',
        'A90077',
        'A90078',
        'A90079',
        'A90080',
        'A90081',
        'A90082',
        'A90083',
        'A90084',
        'A90085',
        'A90086',
        'A90087',
        'A90088',
        'A90089',
        'A90090',
        'A90091',
        'A90092',
        'A90093',
        'A90095',
        'A90097',
        'A90099',
        'A90101',
        'A90102',
        'A90104',
        'A90105',
        'A90106',
        'A90107',
        'A90108',
        'A90109',
        'A90110',
        'A90111',
        'A90112',
        'A90113',
        'A90114',
        'A90115',
        'A90116',
        'A90117',
        'A90118',
        'A90119',
        'A90121',
        'A90122',
        'A90123',
        'A90124',
        'Z10010',
        'A10201',
        'A10202',
        'A10203',
        'A10204',
        'A10206',
        'A10207',
        'A10208',
        'A10209',
        'A10210',
        'A10225',
        'A10227',
        'A10229',
        'A10230',
        'B10306',
        'B10307',
        'B10308',
        'B10309',
        'B10310',
        'B10311',
        'B10312',
        'B10313',
        'B10314',
        'B10315',
        'A10316',
        'A10317',
        'B10318',
        'B10322',
        'B10324',
        'A10325',
        'A10330',
        'A10331',
        'A10332',
        'B10333',
        'B10334',
        'B10335',
        'B10336',
        'B10339',
        'B10340',
        'A10341',
        'B10342',
        'B10343',
        'B10344',
        'B10345',
        'B10347',
        'A10348',
        'B10349',
        'B10350',
        'B10353',
        'B10354',
        'B10355',
        'B10356',
        'B10357',
        'B10358',
        'B10359',
        'B10360',
        'B10361',
        'B10367',
        'B10368',
        'B10369',
        'A10370',
        'B10371',
        'B10372',
        'B10373',
        'B10374',
        'B10376',
        'B10378',
        'B10381',
        'B10383',
        'B10384',
        'B10385',
        'B10386',
        'B10387',
        'B10388',
        'B10389',
        'C10391',
        'C10392',
        'C10393',
        'D10395',
        'D10426',
        'D10508',
        'D10509',
        'D10511',
        'A10512',
        'A12432',
        'A12433',
        'A12451',
        'B12458',
        'B12459',
        'D12460',
        'D12462',
        'C12465',
        'D12466',
        'C12467',
        'A12468',
        'B12469',
        'A12472',
        'C12473',
        'A12475',
        'A12477',
        'A12478',
        'A12481',
        'A12482',
        'A12483',
        'A12484',
        'A12485',
        'A12486',
        'A12487',
        'A12488',
        'A12489',
        'A12490',
        'C12491',
        'A12492',
        'A12493',
        'Z12422',
        'Z12452',
        'Z12463',
        'Z12496',
        'Z12474',
        'Z90073',
        'Z90100',
        'Z90103',
        'Z90120',
        'Z90040',
        'Z90041',
        'A10231',
        'Z10018',
        'Z10019',
        'A10033',
        'A10039',
        'Z10040',
        'Z10199',
        'A40001',
        'A40002',
        'A40003',
        'A40004',
        'A40005',
        'A40006',
        'A40007',
        'A40008',
        'A40009',
        'A40010',
        'A40011',
        'A40012',
        'A40013',
        'A40014',
        'A40015',
        'A40016',
        'A40017',
        'A40018',
        'A40019',
        'A40020',
        'A40021',
        'A40022',
        'A40023',
        'A40024',
        'A40025',
        'A40026',
        'A40027',
        'A40028',
        'A40029',
        'A40030',
        'A40031',
        'B40049',
        'B40051',
        'B10513',
        'B10515',
        'B10429',
        'A12512',
        'B10516',
        'B10337',
        '20000',
        '20001',
        '20002',
        '20003',
        '20004',
        '21001',
        '21002',
        '21003',
        '21004',
        '21005',
        '21006',
        '21007',
        '21008',
        '21009',
        '21010',
        '21011',
        '21012',
        '22000',
        '22001',
        '22002',
        '22003',
        '22004',
        '22009',
        '22010',
        '22011',
        '22012',
        '22013',
        '22014',
        '22015',
        '22016',
        '22017',
        '22018',
        '22019',
        '22020',
        '22021',
        '22022',
        '22023',
        '22024',
        '22025',
        '22026',
        '22027',
        '22028',
        '22029',
        '22030',
        '22031',
        '22032',
        '22033',
        '22034',
        '22035',
        '22039',
        '22040',
        '22041',
        '22042',
        '22043',
        '22044',
        '22045',
        '22046',
        '22048',
        '22049',
        '22051',
        '22052',
        '22053',
        '22054',
        '22055',
        '22056',
        '23001',
        '23002',
        '23003',
        '23004',
        '23005',
        '23006',
        '23007',
        '23008',
        '23009',
        '23010',
        '23011',
        '23012',
        '23013',
        '23014',
        '23015',
        '23016',
        '23017',
        '23018',
        '23019',
        '23020',
        '23021',
        '23022',
        '23023',
        '23024',
        '23025',
        '23026',
        '23027',
        '23028',
        '23029',
        '23030',
        '23031',
        '23032',
        '23033',
        '23034',
        '23035',
        '23036',
        '23037',
        '23038',
        '23039',
        '23040',
        '23041',
        '23042',
        '23043',
        '23044',
        '23045',
        '23046',
        '23047',
        '23048',
        '23049',
        '23050',
        '23051',
        '23052',
        '23053',
        '23054',
        '23055',
        '23056',
        '23058',
        '24001',
        '24002',
        '24003',
        '24004',
        '24005',
        '24006',
        '24007',
        '24008',
        '24009',
        '24010',
        '24011',
        '24012',
        '24013',
        '24014',
        '24015',
        '24016',
        '24017',
        '24018',
        '24019',
        '24020',
        '24021',
        '24022',
        '24023',
        '24024',
        '24025',
        '24026',
        '24027',
        '24028',
        '24029',
        '24030',
        '24031',
        '24032',
        '24033',
        '24034',
        '24035',
        '24036',
        '24037',
        '24038',
        '24039',
        '24040',
        '24041',
        '24042',
        '24043',
        '24044',
        '24045',
        '24046',
        '24047',
        '24048',
        '24049',
        '24050',
        '24051',
        '24052',
        '24053',
        '24054',
        '24055',
        '24056',
        '24057',
        '24058',
        '24060',
        '24061',
        '24062',
        '24063',
        '24064',
        '24065',
        '24066',
        '24067',
        '24068',
        '24069',
        '24070',
        '24071',
        '24072',
        '24073',
        '25001',
        '25002',
        '25003',
        '25004',
        '25005',
        '26000',
        '26001',
        '26002',
        '27000',
        '27001',
        '27002',
        '27003',
        '27004',
        '27005',
        '27006',
        '27007',
        '27008',
        '28000',
        '28001',
        '28002',
        '29001',
        '29002',
        '29003',
        '29004',
        '29999',
        '30000',
        '30001',
        '31000',
        '32000',
        '32001',
        '32002',
        '32003',
        '32004',
        '32005',
        '32006',
        '32007',
        '34001',
        '34002',
        '34003',
        '39999'
    ]

    static final _RESULT_CODE_GROUP2 = [
        'B10301',
        'B10302',
        'B10303',
        'B10304',
        'B10305',
        'B10321',
        'B10326',
        'B10327',
        'B10329',
        'B10338',
        'B10346',
        'B10351',
        'B10352',
        'B10362',
        'B10363',
        'B10364',
        'B10365',
        'B10366',
        'B10375',
        'B10379',
        'B10380',
        'C10394',
        'B10422',
        'D10510',
        'B12456',
        'D12461',
        'C12464',
        'B12480',
        'B12494',
        'B90048',
        'B90050',
        'Z10101',
        'Z10102',
        'Z10103',
        'Z10104',
        'Z10105',
        'Z10106',
        'Z10107',
        'Z10108',
        'Z10109',
        'Z10110',
        'Z10111',
        'Z10112',
        'Z10113',
        'Z10114',
        'Z10116',
        'Z10117',
        'Z10211',
        'Z10212',
        'Z10213',
        'Z10214',
        'Z10215',
        'Z10216',
        'Z10217',
        'Z10218',
        'Z10219',
        'Z10220',
        'Z10221',
        'Z10222',
        'Z10223',
        'Z10224',
        'Z10226',
        'Z10228',
        'Z10232',
        'Z10319',
        'Z10320',
        'Z10323',
        'Z10328',
        'Z10377',
        'Z10382',
        'Z10401',
        'Z10402',
        'Z10403',
        'Z10404',
        'Z10405',
        'Z10406',
        'Z10407',
        'Z10408',
        'Z10409',
        'Z10411',
        'Z10412',
        'Z10414',
        'Z10415',
        'Z10416',
        'Z10420',
        'Z10421',
        'Z10423',
        'Z10424',
        'Z10425',
        'Z10501',
        'Z10502',
        'Z10503',
        'Z10504',
        'Z10505',
        'Z10506',
        'Z10507',
        'Z12401',
        'Z12402',
        'Z12403',
        'Z12404',
        'Z12405',
        'Z12406',
        'Z12407',
        'Z12408',
        'Z12409',
        'Z12410',
        'Z12411',
        'Z12412',
        'Z12413',
        'Z12414',
        'Z12415',
        'Z12416',
        'Z12417',
        'Z12418',
        'Z12419',
        'Z12420',
        'Z12421',
        'Z12423',
        'Z12424',
        'Z12425',
        'Z12426',
        'Z12427',
        'Z12428',
        'Z12429',
        'Y12430',
        'Z12431',
        'Z12434',
        'Z12436',
        'Z12437',
        'Z12438',
        'Z12440',
        'Z12442',
        'Z12443',
        'Z12444',
        'Z12445',
        'Z12446',
        'Z12448',
        'Z12450',
        'Z12453',
        'Z12455',
        'Z12457',
        'Z12471',
        'Z12476',
        'Z12479',
        'Z12497',
        'Z12498',
        'Z13401',
        'Z14401',
        'Z14601',
        'Z15401',
        'Z16401',
        'Z90002',
        'Z90003',
        'Z90004',
        'Z90005',
        'Z90006',
        'Z90007',
        'Z90008',
        'Z90009',
        'Z90010',
        'Z90011',
        'Z90012',
        'Z90013',
        'Z90014',
        'Z90030',
        'Z90031',
        'Z90039',
        'Z90042',
        'Z90043',
        'Z90058',
        'Z90059',
        'Z90060',
        'Z90061',
        'Z90072',
        'Z90034',
        'Z90054',
        'Z90055',
        'Z90056',
        'Z90057',
        'Z10115',
        'Z10118',
        'Z90094',
        'Z90096',
        'Z90098',
        'Z10390',
        'Z10410',
        'Z10413',
        'Z10417',
        'Z10418',
        'Z10419',
        'Z10427',
        'B10428',
        'B10513',
        'Z12404',
        'A12432',
        'Z12435',
        'Z12441',
        'Z12447',
        'Z12449',
        'Z12454',
        'Z12470',
        'Z12495',
        'Z12474',
        'Z12550',
        'Z12551',
        'Z12552',
        'Z12553',
        'Z12502',
        'Z12503',
        'Z12504',
        'Z12505',
        'Z99999',
        'Z10001',
        'Z10002',
        'Z10009',
        'Z10098',
        'Z10099',
        'Z12508',
        'Z12509',
        'Z12510',
        'A10428',
        'Z12506',
        'Z12499',
        'A10200',
        'B10514',
        'A10356',
        'C12511',
        'C12512',
        'B10396',
        'A12511',
        'Z10233'
    ]

    static final _RESULT_CODE_GROUP3 = [
        '22005',
        '22006',
        '22007',
        '22008',
        '22036',
        '22037',
        '22038',
        '22047',
        '22050'
    ]


}
